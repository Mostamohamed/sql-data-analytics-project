/*
===============================================================================
Magnitude Analysis
===============================================================================
Purpose:
    - To quantify data and group results by specific dimensions.
    - For understanding data distribution across categories.

SQL Functions Used:
    - Aggregate Functions: SUM(), COUNT(), AVG()
    - GROUP BY, ORDER BY
===============================================================================
*/

-- Find total customers by countries
SELECT country,COUNT(customer_number) AS total_customers
FROM gold.dim_customers
GROUP BY country
ORDER BY total_customers DESC  -- To Find the country with the highest number of customers

-- Find total customers by gender
SELECT gender,COUNT(customer_number) AS total_customers
FROM gold.dim_customers
GROUP BY gender
ORDER BY total_customers DESC -- To Find the gender with the highest number of customers

-- Find total products by category
SELECT category,COUNT(product_number) AS total_products
FROM gold.dim_products
GROUP BY category
ORDER BY total_products DESC -- To Find the category with the highest number of products

-- What is the average costs in each category?
SELECT category,AVG(cost) AS average_costs
FROM gold.dim_products
GROUP BY category
ORDER BY average_costs DESC -- To Find the most exepensive category 

-- What is the total revenue generated for each category?
SELECT p.category,SUM(f.sales_amount) AS total_revenue
FROM gold.fact_sales f
LEFT JOIN gold.dim_products p
ON p.product_key=f.product_key
GROUP BY p.category
ORDER BY total_revenue DESC -- Find the most revenue for category

-- Find total revenue is generated by each customer?
SELECT c.customer_key,c.first_name,c.last_name,SUM(f.sales_amount) AS total_revenue
FROM gold.fact_sales f
LEFT JOIN gold.dim_customers c
ON c.customer_key=f.customer_key
GROUP BY c.customer_key,c.first_name,c.last_name
ORDER BY total_revenue DESC -- Find the top spenders or the top loyal customer

-- What is the distribution of sold items across countries?
SELECT c.country,SUM(f.quantity) AS total_sold_items
FROM gold.fact_sales f
LEFT JOIN gold.dim_customers c
ON c.customer_key=f.customer_key
GROUP BY c.country
ORDER BY total_sold_items DESC -- Find the top country 
